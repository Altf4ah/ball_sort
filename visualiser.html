<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Water Sort Puzzle Visualiser</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
  .tube { width: 60px; height: 200px; border: 2px solid #333; margin: 10px; display: flex; flex-direction: column-reverse; justify-content: flex-start; }
  .row { display: flex; flex-wrap: wrap; }
  .cell { width: 100%; height: 25%; border-top: 1px solid #000; }
  #controls { margin-top: 20px; }
  button { padding: 10px 20px; margin-right: 10px; }
</style>
</head>
<body>
<h2>Water Sort Puzzle Visualiser</h2>
<p>Load a solution (list of moves), then step through them.</p>

<div id="board" class="row"></div>

<div id="controls">
  <button onclick="prevStep()">◀ Prev</button>
  <button onclick="nextStep()">Next ▶</button>
  <span id="stepLabel">Step: 0</span>
</div>

<script>
// INITIAL TUBES (top → bottom)
let startState = [
  ["red","orange","green","blue"],
  ["orange","purple","green","orange"],
  ["light_purple","blue","cyan","beige"],
  ["teal","dark_green","purple","light_purple"],
  ["cyan","purple","purple","red"],
  ["dark_red","white","blue","pink"],
  ["cyan","dark_red","blue","green"],
  ["pink","pink","beige","red"],
  ["teal","green","red","cyan"],
  ["beige","purple","dark_red","white"],
  ["light_purple","orange","white","beige"],
  ["white","pink","dark_red","dark_green"],
  [], [], // 2 empty tubes
];

// === Load your solution here (example format) ===
// Each move: [fromTubeIndex, toTubeIndex, amount]
// indexes are 0-based
let solution = [ ];
// Example: solution = [[0, 12, 1], [1, 5, 2]];
// ===============================================

let history = [JSON.parse(JSON.stringify(startState))];
let currentStep = 0;

function clone(state) { return JSON.parse(JSON.stringify(state)); }

function applyMove(state, move) {
  let [from, to, amount] = move;
  let newState = clone(state);
  let block = newState[from].splice(0, amount);
  newState[to] = block.concat(newState[to]);
  return newState;
}

function forward() {
  if (currentStep >= solution.length) return;
  let move = solution[currentStep];
  let next = applyMove(history[history.length - 1], move);
  history.push(next);
  currentStep++;
}

function backward() {
  if (currentStep === 0) return;
  history.pop();
  currentStep--;
}

function render() {
  let board = document.getElementById("board");
  board.innerHTML = "";

  let state = history[history.length - 1];

  state.forEach(tube => {
    let t = document.createElement("div");
    t.className = "tube";

    let emptyCells = 4 - tube.length;
    for (let i = 0; i < emptyCells; i++) {
      let c = document.createElement("div");
      c.className = "cell";
      c.style.background = "#ddd";
      t.appendChild(c);
    }

    tube.forEach(color => {
      let c = document.createElement("div");
      c.className = "cell";
      c.style.background = color;
      t.appendChild(c);
    });

    board.appendChild(t);
  });

  document.getElementById("stepLabel").innerText = `Step: ${currentStep}`;
}

function nextStep() {
  forward();
  render();
}

function prevStep() {
  backward();
  render();
}

render();
</script>
</body>
</html>
